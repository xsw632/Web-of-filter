<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hasselblad UI - Fixed Scroll & Upload</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --panel-color: #141414;
            --text-color: #888;
            --accent-color: #ff3b30;
            /* ÂìàËãèÁ∫¢ */
            --highlight-color: #fff;
            --font-main: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            background-color: #000;
            color: var(--text-color);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .camera-body {
            width: 100%;
            max-width: 400px;
            height: 100%;
            max-height: 850px;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.05);
        }

        /* --- Header --- */
        .header {
            text-align: center;
            padding: 20px 0;
            font-size: 12px;
            letter-spacing: 2px;
            color: #555;
            text-transform: uppercase;
            border-bottom: 1px solid #1a1a1a;
            background: #111;
            z-index: 10;
        }

        /* --- Top Wheel (Filter Selector) --- */
        .wheel-container {
            height: 80px;
            background: linear-gradient(to bottom, #1a1a1a, #0f0f0f);
            position: relative;
            overflow: hidden;
            /* Hide scrollbar but allow JS scroll */
            display: flex;
            align-items: center;
            cursor: grab;
            /* Show hand cursor */
        }

        .wheel-container:active {
            cursor: grabbing;
        }

        /* Mask for fade effect on sides */
        .wheel-mask {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, #0a0a0a 0%, transparent 20%, transparent 80%, #0a0a0a 100%);
            pointer-events: none;
            /* Let clicks pass through */
            z-index: 5;
        }

        .wheel-scroller {
            display: flex;
            padding: 0 50%;
            /* Center the first item */
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            /* Firefox */
            height: 100%;
            align-items: center;
            width: 100%;
        }

        .wheel-scroller::-webkit-scrollbar {
            display: none;
        }

        .wheel-item {
            flex: 0 0 80px;
            text-align: center;
            font-size: 14px;
            color: #444;
            scroll-snap-align: center;
            transition: color 0.2s, transform 0.2s;
            position: relative;
            pointer-events: none;
            /* Prevent text selection while dragging */
        }

        .wheel-item.active {
            color: var(--highlight-color);
            font-size: 18px;
            font-weight: bold;
            transform: scale(1.1);
        }

        /* Red Indicator */
        .indicator-line {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 12px;
            background: var(--accent-color);
            z-index: 20;
        }

        /* --- Info Display --- */
        .info-panel {
            background: #111;
            padding: 15px 0;
            text-align: center;
            border-bottom: 1px solid #222;
        }

        .filter-name {
            display: block;
            color: var(--highlight-color);
            font-size: 14px;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .param-status {
            font-size: 10px;
            color: #555;
        }

        /* --- Middle Controls --- */
        .controls-area {
            background: #161616;
            padding: 10px 0;
            position: relative;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
        }

        .mode-btn {
            background: none;
            border: none;
            color: #444;
            font-family: var(--font-main);
            font-size: 10px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .mode-btn.active {
            color: var(--accent-color);
            border-bottom: 1px solid var(--accent-color);
        }

        .ruler-container {
            position: relative;
            height: 50px;
            width: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 80%;
            background: transparent;
            position: relative;
            z-index: 5;
            cursor: ew-resize;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            background: transparent;
            border-top: 8px solid var(--highlight-color);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            cursor: pointer;
            margin-top: -10px;
        }

        .ruler-marks {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 10px;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        .mark {
            width: 1px;
            height: 5px;
            background: #333;
        }

        .mark.big {
            height: 10px;
            background: #555;
        }

        /* --- Viewfinder --- */
        .viewfinder-container {
            flex: 1;
            background: #000;
            margin: 10px;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 2;
        }

        .grid-lines::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .grid-lines::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .viewfinder-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: filter 0.2s ease-out;
        }

        /* --- Bottom Bar & File Input --- */
        .bottom-bar {
            height: 50px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            align-items: center;
            font-size: 14px;
            background: #111;
            border-top: 1px solid #222;
        }

        /* Hide the ugly file input */
        #fileInput {
            display: none;
        }

        /* Style the label as a button */
        .upload-btn {
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .upload-btn:hover {
            background: #222;
        }

        .upload-icon {
            font-size: 18px;
        }
    </style>
</head>

<body>

    <div class="camera-body">
        <div class="header">Hasselblad UI</div>

        <!-- Modified Wheel Structure -->
        <div class="wheel-container" id="wheelContainer">
            <div class="wheel-mask"></div>
            <div class="wheel-scroller" id="filterWheel">
                <!-- Items injected by JS -->
            </div>
            <div class="indicator-line"></div>
        </div>

        <div class="info-panel">
            <span class="filter-name" id="filterName">STD</span>
            <span class="param-status" id="paramStatus">ISO 100 &bull; 0 &bull; 0</span>
        </div>

        <div class="controls-area">
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('iso')">ISO</button>
                <button class="mode-btn" onclick="setMode('contrast')">CON</button>
                <button class="mode-btn" onclick="setMode('saturate')">SAT</button>
            </div>

            <div class="ruler-container">
                <div class="ruler-marks">
                    <div class="mark big"></div>
                    <div class="mark"></div>
                    <div class="mark"></div>
                    <div class="mark"></div>
                    <div class="mark big"></div>
                    <div class="mark"></div>
                    <div class="mark"></div>
                    <div class="mark"></div>
                    <div class="mark big"></div>
                </div>
                <input type="range" id="paramSlider" min="0" max="200" value="100">
            </div>
            <div
                style="display:flex; justify-content:space-between; padding: 0 12%; font-size: 10px; margin-top: -10px; color:#444;">
                <span>-</span>
                <span id="sliderValDisp">0</span>
                <span>+</span>
            </div>
        </div>

        <div class="viewfinder-container">
            <div class="grid-lines"></div>
            <img src="https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=1000" class="viewfinder-img"
                id="mainImage" alt="Viewfinder">
        </div>

        <div class="bottom-bar">
            <!-- New Upload Button -->
            <label for="fileInput" class="upload-btn">
                <span class="upload-icon">üì∑</span>
                <span>Load Image</span>
            </label>
            <input type="file" id="fileInput" accept="image/*">

            <span style="font-size: 18px; color: var(--accent-color);">&bull;</span>
        </div>
    </div>

    <script>
        // --- Data ---
        const filters = [
            { id: 0, label: '15', name: 'STANDARD', settings: { sepia: 0, hue: 0 } },
            { id: 1, label: '30', name: 'VALENCIA', settings: { sepia: 0.4, hue: -10, contrast: 1.1 } },
            { id: 2, label: '60', name: 'NOIR', settings: { sepia: 0, grayscale: 1, contrast: 1.2 } },
            { id: 3, label: '125', name: 'VIVID', settings: { saturate: 1.6, contrast: 1.2 } },
            { id: 4, label: '250', name: 'FADE', settings: { opacity: 0.8, brightness: 1.1, sepia: 0.2 } },
            { id: 5, label: '500', name: 'TEAL', settings: { hue: 180, saturate: 0.6 } },
            { id: 6, label: '800', name: 'WARM', settings: { sepia: 0.3, hue: 5, saturate: 1.2 } },
        ];

        let state = {
            currentFilterIndex: 0,
            mode: 'iso',
            iso: 100,
            contrast: 100,
            saturate: 100
        };

        // --- Elements ---
        const wheelContainer = document.getElementById('wheelContainer');
        const wheelScroller = document.getElementById('filterWheel');
        const filterNameEl = document.getElementById('filterName');
        const paramStatusEl = document.getElementById('paramStatus');
        const paramSlider = document.getElementById('paramSlider');
        const mainImage = document.getElementById('mainImage');
        const sliderValDisp = document.getElementById('sliderValDisp');
        const btns = document.querySelectorAll('.mode-btn');
        const fileInput = document.getElementById('fileInput');

        // --- 1. Filter Wheel Logic (Now with Drag Support) ---
        function initWheel() {
            // Clear previous
            wheelScroller.innerHTML = '';

            filters.forEach((f, index) => {
                const el = document.createElement('div');
                el.className = 'wheel-item';
                el.innerText = f.label;
                wheelScroller.appendChild(el);
            });

            // Add padding to ensure scroll ends work
            const pad = document.createElement('div');
            pad.style.width = "1px";
            pad.style.flex = "0 0 1px";
            wheelScroller.appendChild(pad);
        }

        // Scroll Logic
        wheelScroller.addEventListener('scroll', () => {
            const center = wheelScroller.scrollLeft + (wheelScroller.offsetWidth / 2);
            const items = document.querySelectorAll('.wheel-item');

            let closestDist = Infinity;
            let closestIndex = 0;

            items.forEach((item, index) => {
                const itemCenter = item.offsetLeft + (item.offsetWidth / 2);
                const dist = Math.abs(center - itemCenter);

                if (dist < closestDist) {
                    closestDist = dist;
                    closestIndex = index;
                }

                // Visual Effect
                if (dist < 60) {
                    item.classList.add('active');
                    item.style.opacity = 1;
                } else {
                    item.classList.remove('active');
                    item.style.opacity = 0.3;
                }
            });

            if (state.currentFilterIndex !== closestIndex && closestIndex < filters.length) {
                state.currentFilterIndex = closestIndex;
                updateUI();
            }
        });

        // ** DRAG TO SCROLL IMPLEMENTATION **
        let isDown = false;
        let startX;
        let scrollLeft;

        wheelContainer.addEventListener('mousedown', (e) => {
            isDown = true;
            wheelContainer.classList.add('active');
            startX = e.pageX - wheelContainer.offsetLeft;
            scrollLeft = wheelScroller.scrollLeft;
        });
        wheelContainer.addEventListener('mouseleave', () => { isDown = false; });
        wheelContainer.addEventListener('mouseup', () => { isDown = false; });
        wheelContainer.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - wheelContainer.offsetLeft;
            const walk = (x - startX) * 1.5; // Scroll speed
            wheelScroller.scrollLeft = scrollLeft - walk;
        });

        // --- 2. Image Upload Logic ---
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    mainImage.src = event.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        // --- 3. Parameter Controls ---
        window.setMode = (mode) => {
            state.mode = mode;
            btns.forEach(b => b.classList.remove('active'));

            if (mode === 'iso') btns[0].classList.add('active');
            if (mode === 'contrast') btns[1].classList.add('active');
            if (mode === 'saturate') btns[2].classList.add('active');

            paramSlider.value = state[mode];
            sliderValDisp.innerText = state[mode];
        };

        paramSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            state[state.mode] = val;
            sliderValDisp.innerText = val;
            updateUI();
        });

        // --- 4. Render UI ---
        function updateUI() {
            const currentFilter = filters[state.currentFilterIndex];
            if (!currentFilter) return;

            filterNameEl.innerText = currentFilter.name;

            // Display Logic
            let displayIso = state.iso;
            let displayCon = state.contrast - 100;
            let displaySat = state.saturate - 100;
            paramStatusEl.innerHTML = `ISO ${displayIso} &bull; CON ${displayCon > 0 ? '+' + displayCon : displayCon} &bull; SAT ${displaySat > 0 ? '+' + displaySat : displaySat}`;

            // Filter Logic
            let filterStr = '';

            // Manual params
            const brightnessVal = state.iso / 100;
            const contrastVal = state.contrast / 100;
            const saturateVal = state.saturate / 100;

            filterStr += `brightness(${brightnessVal}) contrast(${contrastVal}) saturate(${saturateVal}) `;

            // Preset params
            const settings = currentFilter.settings;
            if (settings.sepia) filterStr += `sepia(${settings.sepia}) `;
            if (settings.hue) filterStr += `hue-rotate(${settings.hue}deg) `;
            if (settings.grayscale) filterStr += `grayscale(${settings.grayscale}) `;
            if (settings.contrast) filterStr += `contrast(${settings.contrast}) `;
            if (settings.saturate) filterStr += `saturate(${settings.saturate}) `;
            if (settings.opacity) filterStr += `opacity(${settings.opacity}) `;

            mainImage.style.filter = filterStr;
        }

        // Init
        initWheel();
        setTimeout(() => updateUI(), 100);

    </script>
</body>

</html>